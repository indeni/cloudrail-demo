# This is an example for how to run Cloudrail within env0
version: 1

deploy:
  steps:
    terraformPlan:
      after:
        - curl https://cloudrail-cli.s3.amazonaws.com/1.2.130/cli.tar.gz | tar xz
        - export LC_ALL=C.UTF-8
        - export LANG=C.UTF-8
        - mkdir /indeni
        - >
          cloudrail/cloudrail run -p .tf-plan 
          --origin ci 
          --build-link "https://app.env0.com/p/${ENV0_PROJECT_ID}/environments/${ENV0_ENVIRONMENT_ID}"  
          --execution-source-identifier "${ENV0_ENVIRONMENT_ID}" 
          --auto-approve
