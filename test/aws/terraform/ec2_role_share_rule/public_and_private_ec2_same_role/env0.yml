# This is an example for how to run Cloudrail within env0
version: 1

deploy:
  steps:
    terraformPlan:
      after:
        - curl https://cloudrail-cli.s3.amazonaws.com/1.2.130/cli.tar.gz | tar xz
        - uname -a
        - >
          cd cloudrail &&
          LC_ALL=C.UTF-8
          LANG=C.UTF-8
          ./cloudrail run -p ../.tf-plan --directory ../
          --origin ci 
          --build-link "https://app.env0.com/p/${ENV0_PROJECT_ID}/environments/${ENV0_ENVIRONMENT_ID}"  
          --execution-source-identifier "${ENV0_ENVIRONMENT_ID}" 
          --auto-approve
